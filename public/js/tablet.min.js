/*! Copyright 2014 Infocinc (www.infocinc.com)
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
*/
;var CANVAS_RATIO;var DROPS_DRAWN=false;var mediaSwitch;var tablet=namespace("ifc.tablet");var initialScreenType;tablet.carouselHandler=function(direction){var waypoint=this.id;var panelDisplay=$("#"+waypoint+" .content-block").css("display");if(panelDisplay=="none"&&direction=="down"&&carousels[waypoint]===undefined){initCarousel(waypoint)}};tablet.teamHandler=function(direction){var length=$("#screen-team-photo").html().trim().length;if(direction==="down"&&length===0){showPanel("team","nic-button")}};tablet.initWayPoints=function(){$("#services,#screen-method").waypoint(tablet.carouselHandler,{offset:"50%"});$("#team").waypoint(tablet.teamHandler,{offset:"50%"})};function registerMediaCallbacks(){mediaSwitch=false;enquire.register("screen and (min-width:992px)",{unmatch:function(){graph.orientation="horizontal";graph.update([Math.random()*10,Math.random()*10,Math.random()*10,Math.random()*10,Math.random()*10,Math.random()*10,Math.random()*10]);CANVAS_RATIO=0.4},match:function(){graph.orientation="vertical";graph.update([Math.random()*10,Math.random()*10,Math.random()*10,Math.random()*10,Math.random()*10,Math.random()*10,Math.random()*10]);CANVAS_RATIO=0.62}});enquire.register("screen and (min-width:768px)",{unmatch:function(){mediaSwitch=true;if($("#fixed-bar").hasClass("navbar-mini")){$("#fixed-bar").removeClass("navbar-mini")}cm.navMiniMode=false;$.each(carousels,function(key,value){value.stop()});$("#services button, #team button").off();clearInterval(refreshIntervalId);setBarGraph()},match:function(){if(mediaSwitch||cm.screenType==="MOBILE"){initCarousel("services");initCarousel("team");clearInterval(refreshIntervalId);setBarGraph()}var stop=$("#services-banner").offset().top;if((!cm.navMiniMode)&&(stop<$(window).scrollTop())){$("#fixed-bar").addClass("navbar-mini");cm.navMiniMode=true}$("#services button").on("click",function(event){selectButton("services",this);var targetId=event.target.id;var sectionId=$(this).closest(".container-fluid").prop("id");showPanel(sectionId,targetId)});$("#team button").on("click",function(event){selectButton("team",this);var targetId=event.target.id;var sectionId=$(this).closest(".container-fluid").prop("id");showPanel(sectionId,targetId)})}})}function selectButton(sectionId,buttonId){var c=carousels[sectionId];var b=buttonSelected[sectionId];if(c!==undefined){c.pause()}if(b!==undefined){$(b).removeClass("selected-button")}buttonSelected[sectionId]=buttonId;$(buttonId).addClass("selected-button")}tablet.resize=function(){var mediaState=queryMediaState();if(DROPS_DRAWN){var w=CANVAS_WIDTH=$("#bubbles-wrapper").width();var h=CANVAS_HEIGHT=$("#bubbles-wrapper").height();if(context.canvas.width!==CANVAS_WIDTH||context.canvas.height!==CANVAS_HEIGHT){context.canvas.width=CANVAS_WIDTH;context.canvas.height=CANVAS_HEIGHT;background.src="../img/rain.jpg"}}if($("#excel-text").css("display")==="none"){if(mediaState==="TABLET-PORTRAIT"){w=$("#screen-services-visual").width()}else{w=0.3*$("#screen-services").width()}h=CANVAS_RATIO*$("#screen-services").height()}else{w=0.8*$("#services").width();h=200}if(barGraphCtx.canvas.width!==w||barGraphCtx.canvas.height!==h){barGraphCtx.canvas.width=w;barGraphCtx.canvas.height=h;graph.width=barGraphCtx.canvas.width;graph.height=barGraphCtx.canvas.height}};tablet.resizeHandlers=function(){window.addEventListener("resize",tablet.resize,false)};tablet.registerMouseClicks=function(){var path=document.location.pathname;$("#lang-wrapper").on("click",function(){eo=createGaEvent("lang-button",1,path);ga("send",eo)});$("#services-icons button, #team button").on("click",function(e){eo=createGaEvent(e.target.id,1,path);ga("send",eo)})};tablet.initDrops=function(){if($("#bubbles-wrapper").css("display")==="none"){return}REFRESH_RATE=40;t=1;MAX_BUBBLES=90;background=new Image();background.src="../img/rain.jpg";canvas=document.getElementById("bubbles");var selector="#bubbles";var w=$("#bubbles-wrapper").width();var h=$("#bubbles-wrapper").height();$(selector).attr({width:w,height:h});CANVAS_WIDTH=w;CANVAS_HEIGHT=h;context=canvas.getContext("2d");context.drawImage(background,0,0);bubbles=new Array(MAX_BUBBLES);for(var i=0;i<MAX_BUBBLES;i++){bubbles[i]=new Bubble()}DROPS_DRAWN=true;setInterval(drawDrops,REFRESH_RATE)};tablet.modernizrTests=function(complete){var load=[{test:window.matchMedia,nope:"js/vendor/matchMedia.min.js"},{test:window.matchMedia.addListener,nope:"js/vendor/matchMedia.addListener.min.js"},{both:["js/vendor/enquire.min.js"],complete:function(){complete()}}];Modernizr.load(load)};tablet.init=function(){tablet.initWayPoints();tablet.resizeHandlers();tablet.registerMouseClicks();tablet.modernizrTests(registerMediaCallbacks)};var carousels={};var buttonSelected={};var CAROUSEL_WAIT=minToMillis(100);var CAROUSEL_TIMEOUT=secToMillis(300000);function secToMillis(s){return s*1000}function minToMillis(m){return m*secToMillis(60)}var Carousel=function Carousel(){this.active=true;this.currIndex=0;this.prevIndex=-1;this.items;this.timeout;this.timerId;this.id};Carousel.prototype.pause=function(){var that=this;this.stop();this.timerId=setTimeout(function(){that.start()},CAROUSEL_WAIT)};Carousel.prototype.stop=function(){this.active=false;var id=this.id;if(typeof buttonSelected[id]!=="undefined"){$(buttonSelected[this.id]).removeClass("selected-button")}clearTimeout(this.timerId)};Carousel.prototype.start=function(){var id=this.id;var currIndex=0;this.active=true;$.each(this.items,function(key,value){if(value===buttonSelected[id]){currIndex=key+1;return false}});this.prevIndex=currIndex-1;if(currIndex==this.items.length){currIndex=0}this.currIndex=currIndex;if(typeof buttonSelected[id]!=="undefined"){$(buttonSelected[id]).removeClass("selected-button")}nextItem(this.id)};function initCarousel(id,timeout){var c=new Carousel();timeout=typeof timeout!=="undefined"?timeout:CAROUSEL_TIMEOUT;c.timeout=timeout;c.items=$("#"+id+" button");c.id=id;carousels[id]=c;c.start()}function nextItem(id){var c=carousels[id];var currButton;if(c.prevIndex>-1){currButton=c.items.eq(c.prevIndex);$(currButton).removeClass("selected-button")}currButton=c.items.eq(c.currIndex);$(currButton).addClass("selected-button");buttonSelected[id]=currButton;showPanel(id,currButton.prop("id"));c.prevIndex=c.currIndex;c.currIndex++;if(c.currIndex==c.items.length){c.currIndex=0}c.timerId=setTimeout(function(){nextItem(id)},c.timeout)}function prefix(id){return id.split("-")[0].trim()}function fadeHtml(obj,direction,complete){if(direction==="in"){$(obj.selector).fadeIn("linear",function(){if(complete){complete()}})}else{$(obj.selector).fadeOut("linear",function(){complete(obj)})}}function parse(sectionId,buttonId,suffix){var pre=prefix(buttonId);var o={};o.id="#"+pre+"-"+suffix;o.html=$(o.id).html().trim();o.selector="#"+sectionId+"-"+suffix;if(prefix(sectionId)===sectionId){o.selector="#screen-"+sectionId+"-"+suffix}return o}var firstPanel=true;function showPanel(sectionId,buttonId){var t=parse(sectionId,buttonId,"text");var p=parse(sectionId,buttonId,"photo");if(firstPanel){$(t.selector).html(t.html);$(p.selector).html(p.html);firstPanel=false;return}var buttonPrefix=prefix(buttonId);var htmlCallback=function(ob){$(ob.selector).html(ob.html)};var excelCallBack=function(ob){if(buttonPrefix==="excel"){$("#screen-canvas-wrapper").css("display","none");$("#screen-canvas-wrapper").removeClass("hide");$("#screen-canvas-wrapper").fadeIn()}else{$(ob.selector).html(ob.html);fadeHtml(ob,"in")}};var scrollToCallBack=function(ob){$("#screen-services #consult-anchor").scrollTo({speed:800,offset:0,easing:"easeInOutCubic"})};fadeHtml(t,"out",htmlCallback);canvasHide="none"!==$("#screen-canvas-wrapper").css("display");if(canvasHide&&sectionId==="services"){$("#screen-canvas-wrapper").fadeOut(function(){$(p.selector).css("display","none");$(p.selector).html(p.html);fadeHtml(p,"in")})}else{fadeHtml(p,"out",excelCallBack)}if(buttonPrefix==="consult"){fadeHtml(t,"in",scrollToCallBack)}else{fadeHtml(t,"in")}};